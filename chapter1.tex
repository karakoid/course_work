\chapter{ОСНОВНЫЕ ПОНЯТИЯ И ОБЗОР ЛИТЕРАТУРЫ }\label{chap1}


	Управление по прогнозирующей модели (Model Predictive Control) --- способ управления линейными и нелинейными системами, основанный на решении задач оптимального управления с конечным горизонтом в режиме реального времени. \par
	В этой главе описываются основные принципы MPC, базовый алгоритм, рассматриваются задачи оптимального управления и описываются некоторые численные методы решения ЗОУ.
	
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Теория управления по прогнозирующей модели}\label{1sec:MPC}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


	В данном разделе поясним основные принципы теории управления по прогнозирующей модели на примере задачи регулирования для дискретной нелинейной системы.


\subsection{Прогнозирующая модель}
\label{Predictive model}


	Рассмотрим нелинейную дискретную прогнозирующую модель вида:
\begin{equation}\label{nonlinear_system}
	x^+ = f(x, u),
\end{equation}
где функция $ f: X \times U \longrightarrow X $ ставит в соответствие паре $ x \in \mathbb{X} $ и $ u \in \mathbb{U} $ некоторое состояние $ x^+ \in \mathbb{X} $, которое является состоянием системы в последующий момент времени. \par
	Траектория системы \eqref{nonlinear_system} может быть получена следующим образом: с заранее заданным значением $ x_0 \in \mathbb{X} $, а также с управлением $ u(\cdot) \in \mathbb{U}^k,\; k \in \mathbb{N}_\infty $, можно определить значение траектории $ x_u(k) $ итерационно
\begin{align}\label{discrete_system}
	x(0) = x_0,\quad x_u(k + 1) = f(x_u(k), u(k)),
\end{align}
для всех $ k \in \mathbb{N}_0 $, где $ \mathbb{N}_0 = \{0, 1, 2, \ldots \} $.


\subsection{Ограничения}
\label{Constraints}


	Ограничения могут быть как на управление, так и на состояние системы. Введем непустое множество $ X \subseteq \mathbb{X} $ и для каждого $ x \in \mathbb{X} $ введем непустое множество ограничений $ \mathbb{U}(x)\subseteq U $. Множество ограничений $ \mathbb{U}(x) $ может и не зависеть от $ x $. За введением ограничений стоит желание указать, что траектория лежит во множестве $ \mathbb{X} $, а соответствующее траектории управление лежит во множестве $ \mathbb{U}(x) $.


\subsection{Критерий качества}
\label{Quality criterion} 


	Пусть $ x_* \in X $ --- точное решение системы \eqref{discrete_system}. Тогда функция стоимости, которая используется в нашем процессе оптимизации, в критерии качества, должна возвращать значение, основанное на растоянии от любого $ x \in \mathbb{X} $ до $ x_* $. В дополнение к уже сказанному, желательно, чтобы функция стоимости также включала в себя оценку расстояний и по управлению $ u \in \mathbb{U} $. По вычислительным причинам намного удобнее, чтобы управление также оценивалось функцией стоимости. Также оценка управления может быть полезна с точки зрения моделирования, т.к. мы не хотим использовать управление, затратное по ресурсам или энергии. За счет чего функция стоимости имеет вид $ l: X \times U \longrightarrow \mathbb{R}_0^+ $. \par
	Из вышесказанного, можно сделать вывод, что функция стоимости обладает следующими свойствами:
\begin{align*}
	&l(x_*, u_*) = 0,\\
	&l(x, u) > 0, \quad x \in \mathbb{X}, \; u \in \mathbb{U}, \; x \neq x_*.
\end{align*}


\subsection{Базовая формулировка задачи оптимального управления с конечным горизонтом}
\label{Basic wording}


	Базовая формулировка задачи оптимального управления с конечным горизонтом имеет вид:
\begin{equation}\label{mpc_problem}
	\begin{aligned}
		&J_N(x_0, u(\cdot)) = \sum_{k = 0}^{N - 1} l(x_u(k, x_0), \, u(k)) 						\longrightarrow \min,\\
		&x_u(k + 1, \, x_0) = f(x_u(k, x_0), \, u(k)), \quad x_u(0, x_0) = x_0,\\
		&u(\cdot) \in \mathbb{U}^N(x_0), \quad k = 0, 1, \ldots, N - 1.
	\end{aligned}
\end{equation}
	Здесь необходимо минимизировать критерий качества на траектории нелинейной дискретной системы с ограничениями на управление. Результатом решения задачи \eqref{mpc_problem} является последовательность оптимальных управлений $ u^* \in \mathbb{U}^N(x_0) $.

\subsection{Базовый алгоритм MPC}
\label{Basic MPC algorithm}


Идея схемы MPC выглядит так: в каждый момент квантования $ t_n $ оптимизируем предсказанное поведение системы и используем первый элемент результирующей последовательности управлений в качестве значения оценки в следующий момент квантования. Таким образом, базовый алгоритм MPC будет иметь следующий вид: \bigskip

в каждый момент квантования $ t_n, \; n = 0, 1, 2, ... $
\begin{enumerate}
	\item находим состояние $ x(n) \in \mathbb{X} $ системы 								\eqref{discrete_system},
	\item принимаем $ x_0 = x(n) $ и решаем задачу оптимального управления 					\eqref{mpc_problem},
	\item определим значение обратной связи $ \mu_N(x(n)) = u^*(0) \in U $ и 				используем это значение управления в следующем периоде квантования: 				подставляя значение обратной связи в систему \eqref{discrete_system}, 				получим следующее значение траектории и повторяем алгоритм.
\end{enumerate}


\subsection{Выводы}


	Идея MPC: оптимизация будущего поведения системы в каждый момент времени, нахождение оптимального управления и его использования в качестве значения обратной связи для следующего момента времени. Из-за простоты идеи и реализации, MPC получил большое распространение в различного рода промышленных приложениях.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Задачи оптимального управления}
\label{1sec:OCP}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


	В данном разделе приведем основные сведения, касающиеся задач оптимального управления. Рассматриваемая здесь задача --- непрерывная, однако основные элементы в формулировках легко переносятся и на дискретные задачи.


\subsection{Классификация задач оптимального управления}
\label{OCP:Classification}


	Задачи оптимального управления классифицируются по следующим составляющим:
\begin{itemize}
	\item Промежуток времени и управления.\par
		Промежуток времени в задачах оптимального управления может быть как 				непрерывным, т.е. $ t \in \mathbb{R} $, так и дискретным, а именно $ k 				\in \mathbb{N}_0 $. В то же время, промежуток управления может быть 				конечным, что значит $ t \in [t_0, t_f],\; t_0 < t_f $, и бесконечным, 				где $ t \in [t_0, +\infty) $. Время окончания процесса в свою очередь 				также может быть подразделено на фиксированное, т.е $ t_f $ заданно, и не 		фиксированное, где $ t_f $ уже заданно не будет.
	\item Математическая модель объекта управления. \par
		Будем рассматривать объекты управления, которые можно описать 						обыкновенными дифференциальными уравнениями: 
		\begin{align*}
			\dot x = f(x, u, t),
		\end{align*} где
		$ x = x(t) \in \mathbb{R}^n $ --- состояние системы,
		$ u = u(t) \in \mathbb{R}^r $ --- управление.
	\item Классы управлений и ограничение на управление. \par
		Классы управлений могут подразделяться на кусочно-непрерывные, измеримые, 		дискретные, релейные, инерционные и др. функции.
		Ограничение на управление:
		\begin{align*}
			u(t) \in U(t),\quad t \in [t_0, t_f],
		\end{align*}
		где $ U(t) \subseteq \mathbb{R}^n $.
	\item Ограничения на траекторию. \par
		В общем виде ограничения на траекторию имеют вид:
		\begin{align*}
			x \in \mathbb{X}(t),\; t \in [t_0, t_f].
		\end{align*}
		Ограничения на траекторию могут накладываться:
		\begin{itemize}
			\item на правом конце траектории (терминальные ограничения), т.е.
				$ x(t_f) \in \mathbb{X}_f $, откуда могут вытекать задачи с 						закрепленным, свободным и подвижным правым концом траектории;
			\item на левом конце траектории, т.е. $ x(t_0) \in \mathbb{X}_0 $,
				откуда также могут вытекать задачи с закрепленным, свободным и 						подвижным концом траектории;
			\item в промежуточные моменты времени, т.е.
				$ x(t_i) \in \mathbb{X}_i,\; t_i \in [t_0, t_f],\; i = 1, ... , l 				$, при этом $ t_0 < t_1 < ... < t_l < t_f $.
		\end{itemize}
		Существуют и смешанные ограничения на траекторию.
	\item Критерий качества.
		\begin{itemize}
			\item Терминальный критерий (критерий качества типа Майера)
				\begin{align*}
					J(u)=\varphi(x(t_f)),\quad
					\varphi: \mathbb{R}^n \longrightarrow \mathbb{R};
				\end{align*}
			\item Интегральный критерий (критерий качества типа Лагранжа)
				\begin{align*}
					J(u)=\int_{t_0}^{t_f}f_0(x(t), u(t), t)dt,
					\quad f_0: \mathbb{R}^n \times \mathbb{R}^r \times \mathbb{R} 					\longrightarrow \mathbb{R};
				\end{align*}
			\item Критерий качества типа Больца
				\begin{align*}
					J(u)=\varphi(x(t_f)) + \int_{t_0}^{t_f}f_0(x(t),u(t),t)dt;
				\end{align*}
			\item Критерий быстродействия
				\begin{align*}
					J(u)=t_f - t_0 \longrightarrow \min.
				\end{align*}
		\end{itemize}
\end{itemize}


\subsection{Принцип максимума для простейшей задачи оптимального управления}
\label{OCP:Simplest OCP}


Рассмотрим простейшую задачу оптимального управления на промежутке времени
$ [t_0, t_f] $ в классе кусочно-непрерывных управлений: \par
\begin{align}
		\label{opc:criteria}
	&J(u)=\varphi(x(t_f)) \longrightarrow min, \\
		\label{opc:system}
	&\dot x = f(x, u, t),\quad x(t_0) = x_0,  \\
		\label{opc:constraints}
	&u(t) \in \mathbb{U},\quad t \in [t_0, t_f].
\end{align}
В задаче \eqref{opc:criteria}--\eqref{opc:constraints} необходимо минимизировать критерий типа Майера \eqref{opc:criteria} на траектории нелинейной системы \eqref{opc:system} с ограничениями на управление \eqref{opc:constraints}. \par
Принцип максимума. \par
Пусть $ u^0(t),\; t \in [t_0, t_f] $ --- оптимальное управление, $ x^0(t),\; t \in [t_0, t_f] $ --- оптимальная траектория, $ \psi^0(t), \; t \in [t_0, t_f] $ --- сопряженная траектория --- решение сопряженного уравнения
\begin{align*}
	&\psi' = -\frac{\partial H(x^0(t), \psi, u^0(t), t)}{\partial x}, \\
	&\psi = -\frac{\partial \varphi (x^0(t_f))}{\partial x}.
\end{align*}
Тогда необходимо выполняется условие максимума гамильтониана:
\begin{align*}
	H(x^0(t), \psi^0(t), u^0(t), t) = \max_{u \in \mathbb{U}} H(x^0(t), \psi^0(t), u, t), \; t \in [t_0, t_f].
\end{align*}


\subsection{Алгоритм решения задач оптимального управления с помощью принципа максимума}
\label{OCP:Maximum Principle}


Алгоритм решения задачи оптимального управления \eqref{opc:criteria}--\eqref{opc:constraints} из предыдущего пункта состоит из: \par
\begin{itemize}
	\item составления гамильтониана
		\begin{align*}
			H(x, u, \psi, t) = \psi'f(x, u, t),
		\end{align*} где $ \psi = \psi(t) \in \mathbb{R}^n $;
	\item записи сопряженной системы и условия трансверсальности
		\begin{align*}
			&\dot \psi = -\frac{\partial H(x, u, \psi, t)}{\partial x}, \\
			&\psi (t_f) = -\frac{\partial \varphi (x(t_f))}{\partial x};
		\end{align*}
	\item условия максимума гамильтониана
		\begin{align*}
			H(x^0(t), \psi^0(t), u^0(t), t) = \max_{u \in \mathbb{U}} 							H(x^0(t), \psi^0(t), u(t), t),\; t \in [t_0, t_f];
		\end{align*}
	\item рассмотрения задачи максимума гамильтониана
		\begin{align*}
			H(x, \psi, u, t) \longrightarrow max,
		\end{align*} где $ x, \psi, t $ предполагаются фиксированными.
	\item результата решения предыдущего пункта
		\begin{equation}\label{max_principle:control}
			u(x, \psi, t) = arg \max_{u \in \mathbb{U}} H(x, \psi, u, t);
		\end{equation}
	\item подстановки результата в прямую и сопряженную систему
		\begin{equation}\label{max_principle_problem}
			\begin{aligned}
				&\dot x = f(x, u(x, \psi, t), t), \\
				&\dot \psi = -\frac{\partial H(x, \psi, u(x, \psi, t), t)}								{\partial x}, \\
				&x(t_0) = x_0,\quad
					\psi(t_f) = -\frac{\partial \varphi (x(t_f))}{\partial x};
			\end{aligned}
		\end{equation}
	\item решения краевой задачи принципа максимума \eqref{max_principle_problem}
		\begin{align*}
			&x(t), \psi (t),\; t \in [t_0, t_f], \\
			&u(t) = u(x(t), \psi (t), t),\; t \in [t_0, t_f].
		\end{align*}
\end{itemize}
	Описанная схема решения чаще применяется при аналитическом решении задач оптимального управления, поскольку сложно численно установить формулу для управления \eqref{max_principle:control}. На практике используются численные методы.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Численные методы решения задач оптимального управления}
\label{1sec:NM&Software}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


	Рассмотрим некоторые численные методы решения задач оптимального управления:
\begin{itemize}
	\item Численное решение задач оптимального управления с переключением методом пристрелки. \par
	Система дифференциальных уравнений состояния объекта вместе с сопряженной системой, краевыми условиями и принципом максимума Понтрягина составляют П-систему. Интегрирование П-системы осуществляется методом Рунге-Кутта четвертого порядка. Для решения уравнений невязок и подбора уточненных значений параметров пристрелки используется метод Ньютона.
	
	\item Редукция к задаче нелинейного программирования. \par
	Для использования этого метода необходимо перейти от непрерывной системы к дискретной. Отрезок $ [0, T] $ разбивается на $ (k - 1) $ участок, где система $ \dot{x} = f(x, u, t) $, будучи уже дискретной и имеющей вид $ x(t_i) = \eta(x(t_i), \Delta u(t_i), t_i) $, интегрируется по схеме, относящейся к семейству методов Рунге-Кутта. Ограничения заменяются их дискретными аналогами. В результате задача оптимального управления сводится к задаче нелинейного программирования.
	
	\item Метод последовательных приближений. \par
	В качестве начального приближения $ u_0(t) $ выбирается некоторое допустимое управление. Обычно при его выборе используются физические соображения. Метод состоит из последовательных итераций. На $ i $-ой итерации находится решение задачи Коши $ x_i(t) $. Затем интегрированием в обратном времени находится решение $  p_i(t) $ сопряженной системы. После чего, управление $ u_{i + 1}(t) $ определяется из условия максимума, и осуществляется переход к следующей итерации. Процесс продолжается до тех пор, пока на двух последующих итерациях не будет достигнута требуемая точность.
\end{itemize}


\section{Выводы}
	В первой главе были рассмотрены основные принципы управления с прогнозирующей моделью, базовый алгоритм MPC, основные положения задач оптимального управления, принцип максимума, алгоритм решения задач оптимального управления с помощью принципа максимума, а также приведены некоторые численные методы решения задач оптимального управления.